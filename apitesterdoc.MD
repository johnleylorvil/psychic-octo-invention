# ğŸ§ª Guide de Test AvancÃ© - AfÃ¨panou API

## ğŸ¯ ScÃ©narios de Test Complets

### ğŸ“‹ **ScÃ©nario 1 : Utilisateur Client Complet**
```bash
1. Inscription nouveau client
2. Connexion avec JWT
3. Navigation landing page (banners, produits vedettes)
4. Recherche produits "ceramique"
5. Consultation dÃ©tail produit
6. VÃ©rification stock disponible
7. Ajout au panier (2 articles)
8. Modification quantitÃ© panier
9. Validation stock avant checkout
10. CrÃ©ation commande avec adresse livraison
11. Consultation dÃ©tail commande
12. Test annulation commande
```

### ğŸª **ScÃ©nario 2 : Parcours Vendeur**
```bash
1. Inscription compte vendeur (is_seller=True)
2. Connexion et vÃ©rification profil vendeur
3. Consultation API produits (ses produits si implÃ©mentÃ©)
4. Test fonctionnalitÃ©s avancÃ©es vendeur
```

### ğŸ›’ **ScÃ©nario 3 : Gestion Panier AvancÃ©e**
```bash
1. Connexion utilisateur existant
2. Ajout multiples produits diffÃ©rentes catÃ©gories
3. Modification quantitÃ©s diverses
4. Test limite stock (quantitÃ© > stock)
5. Test expiration panier (30 minutes)
6. Validation stock avec erreurs simulÃ©es
7. Suppression articles individuels
8. Vidage complet panier
```

### ğŸ“¦ **ScÃ©nario 4 : Workflow Commandes**
```bash
1. CrÃ©ation commande normale
2. Consultation timeline statuts
3. Test annulation (diffÃ©rentes raisons)
4. CrÃ©ation nouvelle commande
5. Test mise Ã  jour statut (admin)
6. Historique complet commandes
7. RÃ©sumÃ© statistiques commandes
```

## ğŸ”§ Tests SpÃ©cifiques par Endpoint

### **ğŸ” Auth Endpoints (6)**
- `POST /auth/register/` 
  - âœ… DonnÃ©es valides
  - âŒ Email dÃ©jÃ  utilisÃ©
  - âŒ Mots de passe diffÃ©rents
  - âŒ DonnÃ©es manquantes

- `POST /auth/login/`
  - âœ… Username/password correct
  - âœ… Email/password correct
  - âŒ Credentials invalides
  - âŒ Compte dÃ©sactivÃ©

- `POST /auth/logout/`
  - âœ… Token valide
  - âŒ Token invalide/expirÃ©

- `GET /auth/profile/`
  - âœ… Token valide
  - âŒ Non authentifiÃ©

- `PUT /auth/update_profile/`
  - âœ… Mise Ã  jour partielle
  - âœ… Mise Ã  jour complÃ¨te
  - âŒ DonnÃ©es invalides

- `POST /auth/change_password/`
  - âœ… Ancien mot de passe correct
  - âŒ Ancien mot de passe incorrect

### **ğŸ  Landing Page Endpoints (8)**
- Tests de performance cache
- Validation structure donnÃ©es
- Test carrousels et banniÃ¨res
- VÃ©rification produits vedettes

### **ğŸ›ï¸ Products Endpoints (9)**
- Tests pagination
- Filtres avancÃ©s (prix, catÃ©gorie, stock)
- Recherche full-text avec scores
- Gestion stock temps rÃ©el

### **ğŸ›’ Cart Endpoints (7)**
- Race conditions sur stock
- Expiration automatique
- Validation continue stock
- OpÃ©rations en lot

### **ğŸ“¦ Orders Endpoints (6)**
- Workflow statuts complet
- Calculs totaux prÃ©cis
- Gestion annulations
- Historique dÃ©taillÃ©

## ğŸ“Š MÃ©triques de Test

### **ğŸ¯ KPIs Ã  Surveiller**
```python
Performance:
â”œâ”€â”€ Temps rÃ©ponse moyen < 500ms
â”œâ”€â”€ Taux erreur < 5%
â”œâ”€â”€ Cache hit ratio > 80%
â””â”€â”€ Concurrent users support

Business Logic:
â”œâ”€â”€ Stock consistency 100%
â”œâ”€â”€ Calculs prix exacts
â”œâ”€â”€ Workflow statuts respectÃ©s
â””â”€â”€ Race conditions gÃ©rÃ©es

Security:
â”œâ”€â”€ JWT tokens sÃ©curisÃ©s
â”œâ”€â”€ Permissions respectÃ©es  
â”œâ”€â”€ Validation donnÃ©es stricte
â””â”€â”€ Protection CSRF active
```

### **ğŸ” Points de ContrÃ´le Critiques**

#### **Stock Management**
```bash
# Test concurrent cart additions
1. User A ajoute dernier stock item
2. User B essaie simultanÃ©ment
3. VÃ©rifier qu'un seul succÃ¨de
4. VÃ©rifier stock final cohÃ©rent
```

#### **Payment Workflow** (Ã  venir)
```bash
# Test MonCash integration
1. CrÃ©ation commande
2. Redirection gateway
3. Simulation paiement
4. Webhook handling
5. Mise Ã  jour statuts
```

#### **Cache Coherence**
```bash
# Test invalidation cache
1. Modification produit admin
2. VÃ©rifier cache invalidÃ©
3. Nouvelles donnÃ©es servies
4. Performance maintenue
```

## ğŸ› Debugging AvancÃ©

### **ğŸ“‹ Log Analysis**
```python
# Patterns Ã  surveiller dans logs
ERROR_PATTERNS = [
    "InsufficientStockError",
    "JWT token expired", 
    "ValidationError",
    "Race condition detected",
    "Cache miss critical path"
]

PERFORMANCE_PATTERNS = [
    "Query time > 100ms",
    "API response > 1s",
    "Memory usage spike",
    "Database connections peak"
]
```

### **ğŸ”§ Configuration Debug**
```python
# Variables environnement pour tests
TEST_CONFIG = {
    'API_BASE_URL': 'http://localhost:8000/api',
    'LOG_LEVEL': 'DEBUG',
    'ENABLE_PERFORMANCE_TRACKING': True,
    'MOCK_PAYMENT_GATEWAY': True,
    'TEST_USER_PREFIX': 'test_',
    'AUTO_CLEANUP': True
}
```

## ğŸš€ Automatisation Tests

### **ğŸ“… Tests ProgrammÃ©s**
```bash
# Cron job pour tests rÃ©guliers
# Chaque heure : Health check
0 * * * * /path/to/test_health_check.py

# Chaque jour : Full workflow test  
0 2 * * * /path/to/test_full_workflow.py

# Chaque semaine : Performance test
0 2 * * 0 /path/to/test_performance.py
```

### **ğŸ”„ CI/CD Integration**
```yaml
# .github/workflows/api_tests.yml
name: API Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run API tests
        run: python -m pytest api_tests/
      - name: Run Streamlit tests
        run: streamlit run afepanou_api_tester.py --headless
```

## ğŸ“ˆ Optimisations Performance

### **âš¡ Recommandations**
```python
# Optimisations identifiÃ©es via tests
OPTIMIZATIONS = {
    'Database': [
        'Index sur slug, is_active',
        'Select_related produits->catÃ©gorie',
        'Prefetch_related images',
        'Pagination efficace'
    ],
    'Cache': [
        'Cache landing page 5min',
        'Cache produits vedettes 30min', 
        'Cache catÃ©gories 1h',
        'Invalidation intelligente'
    ],
    'API': [
        'Compression gzip',
        'Rate limiting',
        'Response pagination',
        'Minimal field sets'
    ]
}
```

## ğŸ­ Mock & Test Data

### **ğŸ“Š Jeux de DonnÃ©es Test**
```python
# GÃ©nÃ©ration donnÃ©es cohÃ©rentes
TEST_DATA = {
    'users': 100,          # Mix clients/vendeurs
    'categories': 20,      # HiÃ©rarchie 3 niveaux
    'products': 500,       # Stock variables
    'orders': 200,         # DiffÃ©rents statuts
    'reviews': 1000,       # Notes rÃ©parties
}

# ScÃ©narios edge cases
EDGE_CASES = [
    'Stock = 0',
    'Stock = 1 (derniÃ¨re unitÃ©)',
    'Produit digital (stock infini)',
    'Panier expirÃ©',
    'Token JWT expirÃ©',
    'Paiement Ã©chouÃ©',
    'Commande annulÃ©e'
]
```

## ğŸ† Validation Finale

### **âœ… Checklist PrÃ©-Production**
```bash
â–¡ Tous endpoints testÃ©s
â–¡ Authentification sÃ©curisÃ©e
â–¡ Stock management robuste  
â–¡ Performance acceptable
â–¡ Cache fonctionnel
â–¡ Logs informatifs
â–¡ Erreurs gÃ©rÃ©es proprement
â–¡ Documentation complÃ¨te
â–¡ Tests automatisÃ©s
â–¡ Monitoring activÃ©
```

### **ğŸ“‹ MÃ©triques SuccÃ¨s**
```python
SUCCESS_CRITERIA = {
    'API Coverage': '100%',           # Tous endpoints testÃ©s
    'Error Rate': '< 1%',            # TrÃ¨s stable
    'Response Time': '< 300ms',       # Performance excellente
    'Cache Hit': '> 85%',            # Cache efficace
    'Stock Accuracy': '100%',         # CohÃ©rence parfaite
    'Security Score': 'A+',          # SÃ©curitÃ© maximale
}
```

---

## ğŸ¯ Conclusion

Ce guide permet de valider complÃ¨tement votre API AfÃ¨panou avec :
- **Couverture 100%** des endpoints
- **Tests rÃ©alistes** du workflow e-commerce  
- **Debugging avancÃ©** avec logs dÃ©taillÃ©s
- **Validation performance** et sÃ©curitÃ©
- **Automatisation** pour CI/CD

L'outil Streamlit fournit une interface visuelle complÃ¨te pour identifier rapidement les problÃ¨mes et valider les corrections. ğŸš€