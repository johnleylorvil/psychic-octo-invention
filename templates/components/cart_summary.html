{% load static %}

<div class="cart-summary-widget" id="cartSummaryWidget">
    {% if cart and cart.items.exists %}
        <!-- Cart Items Count -->
        <div class="cart-header">
            <h6 class="cart-title">
                <i class="fas fa-shopping-cart me-2" aria-hidden="true"></i>
                Mon Panier ({{ cart.items.count }} article{{ cart.items.count|pluralize }})
            </h6>
        </div>
        
        <!-- Cart Items -->
        <div class="cart-items">
            {% for item in cart.items.all %}
            <div class="cart-item" data-item-id="{{ item.id }}">
                <div class="item-image">
                    {% if item.product.main_image %}
                        <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}" class="img-thumbnail">
                    {% else %}
                        <div class="placeholder-image">
                            <i class="fas fa-image" aria-hidden="true"></i>
                        </div>
                    {% endif %}
                </div>
                
                <div class="item-details">
                    <div class="item-name">
                        <a href="{% url 'marketplace:product_detail' slug=item.product.slug %}" class="product-link">
                            {{ item.product.name|truncatechars:40 }}
                        </a>
                    </div>
                    
                    <div class="item-price">
                        <span class="quantity">{{ item.quantity }}x</span>
                        <span class="price">{{ item.product.effective_price|floatformat:2 }} HTG</span>
                    </div>
                    
                    <div class="item-total">
                        <strong>{{ item.total_price|floatformat:2 }} HTG</strong>
                    </div>
                </div>
                
                <div class="item-actions">
                    <button 
                        class="btn btn-sm btn-outline-danger remove-item" 
                        data-item-id="{{ item.id }}"
                        aria-label="Supprimer cet article"
                        title="Supprimer"
                    >
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Cart Total -->
        <div class="cart-total">
            <div class="subtotal-row">
                <span>Sous-total:</span>
                <span class="subtotal-amount">{{ cart.subtotal|floatformat:2 }} HTG</span>
            </div>
            
            {% if cart.shipping_cost %}
            <div class="shipping-row">
                <span>Livraison:</span>
                <span class="shipping-amount">{{ cart.shipping_cost|floatformat:2 }} HTG</span>
            </div>
            {% endif %}
            
            {% if cart.tax_amount %}
            <div class="tax-row">
                <span>Taxes:</span>
                <span class="tax-amount">{{ cart.tax_amount|floatformat:2 }} HTG</span>
            </div>
            {% endif %}
            
            <div class="total-row">
                <strong>
                    <span>Total:</span>
                    <span class="total-amount">{{ cart.total_price|floatformat:2 }} HTG</span>
                </strong>
            </div>
        </div>
        
        <!-- Cart Actions -->
        <div class="cart-actions">
            <a href="{% url 'marketplace:cart' %}" class="btn btn-outline-primary btn-sm me-2">
                <i class="fas fa-edit me-1" aria-hidden="true"></i>
                Modifier
            </a>
            
            <a href="{% url 'marketplace:checkout' %}" class="btn btn-primary btn-sm">
                <i class="fas fa-credit-card me-1" aria-hidden="true"></i>
                Commander
            </a>
        </div>
        
    {% else %}
        <!-- Empty Cart -->
        <div class="empty-cart text-center py-4">
            <div class="empty-cart-icon mb-3">
                <i class="fas fa-shopping-cart fa-3x text-muted" aria-hidden="true"></i>
            </div>
            <h6 class="empty-cart-title">Votre panier est vide</h6>
            <p class="empty-cart-text text-muted">
                Découvrez nos produits et ajoutez-les à votre panier.
            </p>
            <a href="{% url 'marketplace:home' %}" class="btn btn-primary btn-sm">
                <i class="fas fa-shopping-bag me-1" aria-hidden="true"></i>
                Continuer vos achats
            </a>
        </div>
    {% endif %}
</div>