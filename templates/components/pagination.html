{% load static %}
{% if is_paginated %}
<nav class="pagination-nav" role="navigation" aria-label="Navigation des pages">
    <div class="pagination">
        
        <!-- Previous page -->
        {% if page_obj.has_previous %}
            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page=1" 
               class="pagination__link pagination__link--first" 
               aria-label="Aller à la première page">
                <i class="fas fa-angle-double-left" aria-hidden="true"></i>
                <span class="sr-only">Premye paj la</span>
            </a>
            
            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}" 
               class="pagination__link pagination__link--prev" 
               aria-label="Aller à la page précédente">
                <i class="fas fa-angle-left" aria-hidden="true"></i>
                <span class="pagination__text">Anvan</span>
            </a>
        {% else %}
            <span class="pagination__link pagination__link--disabled">
                <i class="fas fa-angle-double-left" aria-hidden="true"></i>
                <span class="sr-only">Premye paj la</span>
            </span>
            
            <span class="pagination__link pagination__link--disabled">
                <i class="fas fa-angle-left" aria-hidden="true"></i>
                <span class="pagination__text">Anvan</span>
            </span>
        {% endif %}

        <!-- Page numbers -->
        <div class="pagination__numbers">
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <span class="pagination__link pagination__link--current" aria-current="page">
                        {{ num }}
                        <span class="sr-only">(paj aktyèl la)</span>
                    </span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page={{ num }}" 
                       class="pagination__link pagination__link--number"
                       aria-label="Aller à la page {{ num }}">
                        {{ num }}
                    </a>
                {% elif num == page_obj.number|add:'-4' or num == page_obj.number|add:'4' %}
                    <span class="pagination__ellipsis" aria-hidden="true">...</span>
                {% endif %}
            {% endfor %}
        </div>

        <!-- Next page -->
        {% if page_obj.has_next %}
            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.next_page_number }}" 
               class="pagination__link pagination__link--next" 
               aria-label="Aller à la page suivante">
                <span class="pagination__text">Apre</span>
                <i class="fas fa-angle-right" aria-hidden="true"></i>
            </a>
            
            <a href="?{% if request.GET.urlencode %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.paginator.num_pages }}" 
               class="pagination__link pagination__link--last" 
               aria-label="Aller à la dernière page">
                <span class="sr-only">Dènye paj la</span>
                <i class="fas fa-angle-double-right" aria-hidden="true"></i>
            </a>
        {% else %}
            <span class="pagination__link pagination__link--disabled">
                <span class="pagination__text">Apre</span>
                <i class="fas fa-angle-right" aria-hidden="true"></i>
            </span>
            
            <span class="pagination__link pagination__link--disabled">
                <span class="sr-only">Dènye paj la</span>
                <i class="fas fa-angle-double-right" aria-hidden="true"></i>
            </span>
        {% endif %}
    </div>
    
    <!-- Page info -->
    <div class="pagination-info">
        <span class="pagination-info__text">
            Montre {{ page_obj.start_index }} nan {{ page_obj.end_index }} 
            soti nan {{ page_obj.paginator.count }} rezilta yo
        </span>
        
        <!-- Items per page selector -->
        <div class="pagination-info__per-page">
            <label for="items-per-page" class="pagination-info__label">Rezilta yo pou chak paj:</label>
            <select id="items-per-page" class="pagination-info__select" onchange="changeItemsPerPage(this.value)">
                <option value="12" {% if request.GET.per_page == "12" or not request.GET.per_page %}selected{% endif %}>12</option>
                <option value="24" {% if request.GET.per_page == "24" %}selected{% endif %}>24</option>
                <option value="48" {% if request.GET.per_page == "48" %}selected{% endif %}>48</option>
            </select>
        </div>
    </div>
</nav>

<script>
function changeItemsPerPage(value) {
    const url = new URL(window.location.href);
    url.searchParams.set('per_page', value);
    url.searchParams.delete('page'); // Reset to first page
    window.location.href = url.toString();
}
</script>
{% endif %}