{% load static %}

<div class="search-container">
    <form class="search-form" method="GET" action="{% url 'marketplace:search' %}" role="search">
        <div class="input-group">
            <input 
                type="search" 
                class="form-control search-input" 
                name="q"
                value="{{ request.GET.q|default:'' }}"
                placeholder="Rechercher produits et services..."
                aria-label="Rechercher des produits"
                autocomplete="off"
            >
            <div class="input-group-append">
                <!-- Category Filter -->
                <select 
                    class="form-select category-select d-none d-md-block" 
                    name="category" 
                    aria-label="Filtrer par catégorie"
                >
                    <option value="">Toutes catégories</option>
                    {% for category in categories %}
                    <option value="{{ category.slug }}" 
                            {% if request.GET.category == category.slug %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
                
                <!-- Search Button -->
                <button class="btn btn-primary search-btn" type="submit" aria-label="Lancer la recherche">
                    <i class="fas fa-search" aria-hidden="true"></i>
                    <span class="d-none d-lg-inline ms-1">Rechercher</span>
                </button>
            </div>
        </div>
        
        <!-- Search Suggestions (Hidden by default, shown via JavaScript) -->
        <div class="search-suggestions" id="searchSuggestions" style="display: none;">
            <div class="suggestions-header">
                <h6>Suggestions populaires</h6>
            </div>
            <div class="suggestions-list">
                <!-- Populated via AJAX -->
            </div>
        </div>
    </form>
</div>

<!-- Mobile Search Toggle (for small screens) -->
<button class="mobile-search-toggle d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSearch" aria-expanded="false" aria-controls="mobileSearch" aria-label="Ouvrir la recherche">
    <i class="fas fa-search" aria-hidden="true"></i>
</button>

<!-- Mobile Search Collapse -->
<div class="collapse d-md-none mt-3" id="mobileSearch">
    <form class="mobile-search-form" method="GET" action="{% url 'marketplace:search' %}">
        <div class="input-group">
            <input 
                type="search" 
                class="form-control" 
                name="q"
                value="{{ request.GET.q|default:'' }}"
                placeholder="Que cherchez-vous?"
                aria-label="Rechercher des produits"
            >
            <button class="btn btn-primary" type="submit">
                <i class="fas fa-search" aria-hidden="true"></i>
            </button>
        </div>
        <select class="form-select mt-2" name="category">
            <option value="">Toutes catégories</option>
            {% for category in categories %}
            <option value="{{ category.slug }}" 
                    {% if request.GET.category == category.slug %}selected{% endif %}>
                {{ category.name }}
            </option>
            {% endfor %}
        </select>
    </form>
</div>