{% extends 'emails/base_email.html' %}

{% block email_title %}Konfirmasyon Kòmand - Afèpanou{% endblock %}

{% block email_greeting %}
Bonjou {{ order.user.first_name|default:order.user.username }}!
{% endblock %}

{% block email_content %}
<p>
    Nou kontan pou nou konfime resepsyon kòmand ou an. Nou ap trete li kounye a ak anpil atansyon.
</p>

<div style="background-color: #F8F9FA; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <h3 style="color: #E67E22; margin-bottom: 15px;">Detay Kòmand lan</h3>
    
    <p><strong>Nimewo Kòmand:</strong> #{{ order.order_number }}</p>
    <p><strong>Dat:</strong> {{ order.created_at|date:"d F Y" }}</p>
    <p><strong>Estati:</strong> <span style="color: #27AE60;">{{ order.get_status_display }}</span></p>
</div>

<h3 style="color: #343A40; margin-bottom: 15px;">Pwodwi yo nan Kòmand lan</h3>

<div style="border: 1px solid #DEE2E6; border-radius: 8px; margin: 20px 0;">
    {% for item in order.items.all %}
    <div style="padding: 15px; border-bottom: 1px solid #DEE2E6; {% if forloop.last %}border-bottom: none;{% endif %}">
        <div style="display: table; width: 100%;">
            <div style="display: table-cell; vertical-align: top; width: 100px;">
                {% if item.product.images.first %}
                    <img src="{{ item.product.images.first.image.url }}" 
                         alt="{{ item.product.name }}"
                         style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                {% endif %}
            </div>
            <div style="display: table-cell; vertical-align: top; padding-left: 15px;">
                <h4 style="margin: 0 0 8px 0; color: #343A40;">{{ item.product.name }}</h4>
                <p style="margin: 0; color: #6C757D; font-size: 14px;">
                    Vandè: {{ item.product.seller.business_name|default:item.product.seller.username }}
                </p>
                <p style="margin: 8px 0 0 0;">
                    <strong>{{ item.quantity }}x {{ item.price }} HTG = {{ item.get_total_price }} HTG</strong>
                </p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div style="background-color: #E8F5E8; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <div style="text-align: right;">
        <p style="margin: 5px 0;"><strong>Sous-total:</strong> {{ order.get_subtotal }} HTG</p>
        {% if order.shipping_cost %}
        <p style="margin: 5px 0;"><strong>Frè livrezon:</strong> {{ order.shipping_cost }} HTG</p>
        {% endif %}
        {% if order.tax_amount %}
        <p style="margin: 5px 0;"><strong>Taks:</strong> {{ order.tax_amount }} HTG</p>
        {% endif %}
        <h3 style="color: #27AE60; margin: 10px 0 0 0;"><strong>Total:</strong> {{ order.get_total_price }} HTG</h3>
    </div>
</div>

<h3 style="color: #343A40; margin-bottom: 15px;">Enfòmasyon Livrezon</h3>

<div style="background-color: #F8F9FA; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <p style="margin: 5px 0;"><strong>Non:</strong> {{ order.shipping_first_name }} {{ order.shipping_last_name }}</p>
    <p style="margin: 5px 0;"><strong>Adrès:</strong></p>
    <p style="margin: 5px 0; padding-left: 15px;">
        {{ order.shipping_address }}<br>
        {{ order.shipping_city }}, {{ order.shipping_state }} {{ order.shipping_zip }}<br>
        {{ order.shipping_country }}
    </p>
    <p style="margin: 5px 0;"><strong>Telefòn:</strong> {{ order.shipping_phone }}</p>
</div>

<h3 style="color: #343A40; margin-bottom: 15px;">Enfòmasyon Peman</h3>

<div style="background-color: #F8F9FA; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <p style="margin: 5px 0;"><strong>Metòd Peman:</strong> {{ order.payment_method|default:"MonCash" }}</p>
    {% if order.transaction %}
    <p style="margin: 5px 0;"><strong>ID Tranzaksyon:</strong> {{ order.transaction.transaction_id }}</p>
    <p style="margin: 5px 0;"><strong>Estati Peman:</strong> 
        <span style="color: {% if order.transaction.status == 'completed' %}#27AE60{% else %}#F39C12{% endif %};">
            {{ order.transaction.get_status_display }}
        </span>
    </p>
    {% endif %}
</div>

<p>
    <strong>Kisa ki rive apre sa?</strong><br>
    Nou ap kòmanse prepare kòmand ou an ak vandè yo ak nou ap voye ou yon email konfirmasyon lè nou prèt pou nou livre li.
</p>

<p style="text-align: center; margin: 30px 0;">
    <a href="{% url 'order_detail' order.order_number %}" class="email-button">
        Gade Detay Kòmand lan
    </a>
</p>

<p>
    Si ou gen nenpòt kesyon konsènan kòmand ou an, pa ezite kontak ekip sèvis kliyantèl nou an. 
    Nou la pou ede ou!
</p>

<p>
    Mèsi anpil pou ou te chwazi Afèpanou. Nou apresye sipò ou nan kwasans ekonomi lokal Ayiti a.
</p>

<p style="margin-top: 30px;">
    Avèk respè,<br>
    <strong>Ekip Afèpanou</strong>
</p>
{% endblock %}