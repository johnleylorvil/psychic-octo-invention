<!-- templates/store/moncash_return.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Retour du Paiement - Afèpanou Marketplace{% endblock %}
{% block description %}Page de confirmation après votre tentative de paiement via MonCash.{% endblock %}

{% block content %}
<div class="moncash-return-container">
    <!-- Section de statut du paiement -->
    <section class="section py-16">
        <div class="container max-w-3xl">
            <div class="content-card text-center">
                <div class="content-image bg-gradient-to-r from-orange-400 to-orange-600 mx-auto mb-8 rounded-2xl" style="width: 120px; height: 120px; display: flex; align-items: center; justify-content: center;">
                    {% if success %}
                        <i class="fas fa-check-circle text-6xl text-white"></i>
                    {% else %}
                        <i class="fas fa-exclamation-circle text-6xl text-white"></i>
                    {% endif %}
                </div>

                <div class="content-info">
                    {% if success %}
                        <h1 class="content-title text-3xl mb-4">Paiement Réussi !</h1>
                        <p class="content-description text-lg mb-6">
                            Merci pour votre achat. Votre paiement a été traité avec succès.
                        </p>
                    {% else %}
                        <h1 class="content-title text-3xl mb-4">Paiement Échoué</h1>
                        <p class="content-description text-lg mb-6">
                            Votre paiement n'a pas pu être complété. Veuillez réessayer ou contacter le support.
                        </p>
                    {% endif %}

                    <!-- Détails de la commande -->
                    {% if order %}
                    <div class="bg-soft p-6 rounded-2xl mb-8 text-left">
                        <h2 class="text-xl font-semibold text-dark mb-4">Détails de la Commande</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-light">Numéro de commande</p>
                                <p class="font-medium">{{ order.order_number }}</p>
                            </div>
                            <div>
                                <p class="text-sm text-light">Date</p>
                                <p class="font-medium">{{ order.created_at|date:"d M Y, H:i" }}</p>
                            </div>
                            <div>
                                <p class="text-sm text-light">Montant total</p>
                                <p class="font-medium text-primary text-xl">{{ order.total_amount }} HTG</p>
                            </div>
                            <div>
                                <p class="text-sm text-light">Statut du paiement</p>
                                {% if success %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check mr-1"></i> Réussi
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-times mr-1"></i> Échoué
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Message d'erreur spécifique -->
                    {% if not success and transaction %}
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 text-left">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-exclamation-triangle text-red-500"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-red-700">
                                    <span class="font-medium">Erreur:</span> {{ transaction.gateway_response.payment.message|default:"Le paiement a été refusé ou annulé." }}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Actions -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                        {% if success %}
                            <a href="{% url 'core:home' %}" class="btn btn-primary">
                                <i class="fas fa-home mr-2"></i> Retour à l'Accueil
                            </a>
                            {% if order %}
                            <a href="mailto:support@afepanou.com?subject=Commande {{ order.order_number }}" class="btn btn-outline">
                                <i class="fas fa-envelope mr-2"></i> Contacter le Support
                            </a>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'core:home' %}" class="btn btn-primary">
                                <i class="fas fa-redo mr-2"></i> Réessayer
                            </a>
                            <a href="mailto:support@afepanou.com?subject=Problème de Paiement" class="btn btn-outline">
                                <i class="fas fa-headset mr-2"></i> Assistance
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section d'informations supplémentaires -->
    <section class="section bg-soft py-12">
        <div class="container max-w-4xl">
            <div class="text-center mb-12">
                <h2 class="section-title mb-4">Prochaines Étapes</h2>
                <p class="section-subtitle text-light max-w-2xl mx-auto">
                    Voici ce que vous pouvez faire après cette étape
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center p-6 bg-white rounded-2xl shadow-soft">
                    <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-truck text-orange-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Livraison</h3>
                    <p class="text-light">
                        {% if success %}
                            Votre commande est en cours de préparation pour la livraison.
                        {% else %}
                            Une fois le paiement réussi, votre commande sera traitée.
                        {% endif %}
                    </p>
                </div>
                
                <div class="text-center p-6 bg-white rounded-2xl shadow-soft">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Confirmation</h3>
                    <p class="text-light">
                        {% if success %}
                            Vous recevrez bientôt un email de confirmation.
                        {% else %}
                            Vous pouvez réessayer le paiement ou contacter le support.
                        {% endif %}
                    </p>
                </div>
                
                <div class="text-center p-6 bg-white rounded-2xl shadow-soft">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-headset text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Support</h3>
                    <p class="text-light">
                        Notre équipe est disponible pour répondre à vos questions.
                    </p>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Styles spécifiques à la page de retour MonCash */
.moncash-return-container {
    margin-top: var(--header-height, 80px); /* Compenser la hauteur du header fixe */
}

.content-card {
    max-width: 100%;
    margin: 0 auto;
    border: 1px solid var(--border-light);
}

/* Animation pour l'icône de statut */
@keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    70% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
}

.content-image {
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* Responsive */
@media (max-width: 768px) {
    .content-title {
        font-size: var(--text-2xl);
    }
    
    .content-description {
        font-size: var(--text-base);
    }
    
    .section {
        padding: var(--space-12) 0;
    }
}
</style>
{% endblock %}