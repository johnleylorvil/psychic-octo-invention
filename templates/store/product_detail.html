<!-- templates/store/product_detail.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - {{ category.name }} | Afèpanou Marketplace{% endblock %}
{% block description %}{{ product.description|truncatewords:30 }}{% endblock %}
{% block og_title %}{{ product.name }}{% endblock %}
{% block og_description %}{{ product.description|truncatewords:30 }}{% endblock %}
{% block og_image %}{% if product.images.exists %}{{ product.images.first.image.url }}{% else %}{% static 'images/placeholder-product.jpg' %}{% endif %}{% endblock %}
{% block twitter_title %}{{ product.name }}{% endblock %}
{% block twitter_description %}{{ product.description|truncatewords:30 }}{% endblock %}

{% block content %}
<div class="product-detail-container">
    <!-- Breadcrumbs (optionnel mais utile) -->
    <nav class="breadcrumb-section bg-soft py-4" aria-label="Fil d'Ariane">
        <div class="container">
            <ol class="flex items-center text-sm text-light">
                <li><a href="{% url 'core:home' %}" class="hover:text-primary transition">Accueil</a></li>
                <li class="mx-2">/</li>
                <li><a href="{% url 'store:store_view' category.name|lower %}" class="hover:text-primary transition">{{ category.name }}</a></li>
                <li class="mx-2">/</li>
                <li class="text-dark font-medium" aria-current="page">{{ product.name }}</li>
            </ol>
        </div>
    </nav>

    <!-- Product Detail Section -->
    <section class="product-detail-section section py-12">
        <div class="container">
            <div class="product-detail-grid grid grid-cols-1 md:grid-cols-2 gap-12">
                <!-- Product Image Gallery -->
                <div class="product-gallery">
                    <div class="main-image-container bg-beige rounded-2xl overflow-hidden shadow-soft mb-6 relative" style="aspect-ratio: 1/1;">
                        {% if product.images.exists %}
                            <img id="main-product-image" src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="w-full h-full object-contain">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center text-muted">
                                <i class="fas fa-image text-6xl"></i>
                            </div>
                        {% endif %}
                    </div>
                    {% if product.images.count > 1 %}
                    <div class="thumbnail-gallery flex gap-4 overflow-x-auto pb-2">
                        {% for image in product.images.all %}
                        <button class="thumbnail-btn border-2 rounded-lg overflow-hidden flex-shrink-0" 
                                data-full-image="{{ image.image.url }}" 
                                aria-label="Voir l'image {{ forloop.counter }}">
                            <img src="{{ image.image.url }}" alt="Vignette {{ product.name }}" class="w-20 h-20 object-cover">
                        </button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- Product Information -->
                <div class="product-info">
                    <div class="info-header mb-6">
                        <h1 class="product-title text-3xl font-bold text-dark mb-3">{{ product.name }}</h1>
                        <p class="product-category text-sm text-light mb-2">
                            <i class="fas fa-tag mr-2"></i> {{ category.name }}
                        </p>
                        <div class="product-rating flex items-center mb-4">
                            <!-- Exemple de notation, à adapter avec vos données -->
                            <div class="stars flex text-amber-400">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <span class="rating-text text-sm text-light ml-2">(4.5 - 12 avis)</span>
                        </div>
                    </div>

                    <div class="info-body mb-8">
                        <div class="product-price mb-6">
                            <span class="current-price text-3xl font-bold text-primary">{{ product.current_price }} HTG</span>
                            {% if product.original_price and product.original_price > product.current_price %}
                                <span class="original-price text-lg text-muted line-through ml-3">{{ product.original_price }} HTG</span>
                                <span class="discount-badge bg-forest text-white text-xs font-semibold px-2 py-1 rounded-full ml-3">
                                    -{{ product.discount_percentage }}%
                                </span>
                            {% endif %}
                        </div>

                        <div class="product-meta mb-6">
                            <div class="flex items-center mb-3">
                                <span class="text-dark font-medium mr-3">Disponibilité:</span>
                                {% if product.stock_quantity > 0 %}
                                    <span class="text-forest flex items-center">
                                        <i class="fas fa-check-circle mr-1"></i> En Stock ({{ product.stock_quantity }} disponibles)
                                    </span>
                                {% else %}
                                    <span class="text-red-500 flex items-center">
                                        <i class="fas fa-times-circle mr-1"></i> Épuisé
                                    </span>
                                {% endif %}
                            </div>
                            <div class="flex items-center">
                                <span class="text-dark font-medium mr-3">Vendu par:</span>
                                <span class="text-light">{{ product.seller.get_full_name|default:product.seller.username }}</span>
                            </div>
                        </div>

                        <div class="product-description mb-6">
                            <h3 class="text-lg font-semibold text-dark mb-3">Description</h3>
                            <p class="text-light leading-relaxed">{{ product.description }}</p>
                        </div>
                    </div>

                    <!-- Product Actions -->
                    <div class="product-actions">
                        {% if product.stock_quantity > 0 %}
                        <form id="add-to-cart-form" class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                            <div class="quantity-selector flex items-center">
                                <label for="quantity" class="mr-3 text-dark font-medium">Quantité:</label>
                                <div class="flex items-center border border-light rounded-full overflow-hidden">
                                    <button type="button" id="decrease-qty" class="px-4 py-2 text-lg hover:bg-beige transition">-</button>
                                    <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock_quantity }}" class="w-16 text-center border-0 focus:ring-0">
                                    <button type="button" id="increase-qty" class="px-4 py-2 text-lg hover:bg-beige transition">+</button>
                                </div>
                                <span class="ml-3 text-sm text-light">({{ product.stock_quantity }} disponibles)</span>
                            </div>
                            <button type="submit" id="add-to-cart-btn" class="btn btn-primary flex-1 sm:flex-none">
                                <i class="fas fa-shopping-cart mr-2"></i> Ajouter au Panier
                            </button>
                        </form>
                        <button id="buy-now-btn" class="btn btn-secondary w-full mt-4">
                            <i class="fas fa-bolt mr-2"></i> Acheter Maintenant
                        </button>
                        {% else %}
                        <div class="text-center py-6 bg-soft rounded-2xl">
                            <i class="fas fa-exclamation-circle text-3xl text-muted mb-3"></i>
                            <p class="text-lg text-dark font-semibold">Ce produit est actuellement indisponible.</p>
                            <p class="text-light">Veuillez revenir plus tard ou contacter le vendeur.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products Section (placeholder) -->
    <section class="related-products-section section bg-soft py-16">
        <div class="container">
            <div class="section-header text-center mb-12">
                <h2 class="section-title">Produits Similaires</h2>
                <p class="section-subtitle">Découvrez d'autres produits de la catégorie {{ category.name }}</p>
            </div>
            <div class="related-products-grid grid grid-cols-2 md:grid-cols-4 gap-6">
                <!-- Placeholder cards - à remplacer par des vrais produits -->
                <div class="product-card">
                    <div class="product-image bg-beige flex items-center justify-center">
                        <i class="fas fa-box text-3xl text-muted"></i>
                    </div>
                    <div class="product-info p-4">
                        <h3 class="product-title text-lg font-semibold mb-2">Produit Similaire 1</h3>
                        <span class="product-price text-primary font-bold">1 200 HTG</span>
                    </div>
                </div>
                <div class="product-card">
                    <div class="product-image bg-beige flex items-center justify-center">
                        <i class="fas fa-box text-3xl text-muted"></i>
                    </div>
                    <div class="product-info p-4">
                        <h3 class="product-title text-lg font-semibold mb-2">Produit Similaire 2</h3>
                        <span class="product-price text-primary font-bold">850 HTG</span>
                    </div>
                </div>
                <div class="product-card">
                    <div class="product-image bg-beige flex items-center justify-center">
                        <i class="fas fa-box text-3xl text-muted"></i>
                    </div>
                    <div class="product-info p-4">
                        <h3 class="product-title text-lg font-semibold mb-2">Produit Similaire 3</h3>
                        <span class="product-price text-primary font-bold">2 500 HTG</span>
                    </div>
                </div>
                <div class="product-card">
                    <div class="product-image bg-beige flex items-center justify-center">
                        <i class="fas fa-box text-3xl text-muted"></i>
                    </div>
                    <div class="product-info p-4">
                        <h3 class="product-title text-lg font-semibold mb-2">Produit Similaire 4</h3>
                        <span class="product-price text-primary font-bold">3 100 HTG</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* ========== STYLES SPÉCIFIQUES À LA PAGE DE DÉTAIL PRODUIT ========== */
:root {
  /* Vous pouvez réutiliser les variables de main.css ici si elles sont définies globalement */
  /* Exemple : --primary-orange: #e9741c; etc. */
  /* Si elles ne sont pas globales, définissez-les ici ou assurez-vous qu'elles sont accessibles */
  /* Couleurs spécifiques à la page produit si nécessaire */
  --product-detail-bg: #ffffff;
  --product-detail-border: #e5e7eb; /* Couleur de bordure douce */
  --rating-star: #fbbf24; /* Couleur des étoiles */
  --rating-star-empty: #d1d5db; /* Couleur des étoiles vides */
  --badge-discount-bg: #166534; /* Vert foncé pour badge réduction */
  --badge-stock-bg: #16a34a; /* Vert pour badge en stock */
  --badge-outofstock-bg: #dc2626; /* Rouge pour badge épuisé */
}

.product-detail-container {
  /* Utiliser la variable CSS définie dans main.css si elle existe */
  margin-top: var(--header-height, 80px);
  background-color: var(--product-detail-bg);
  padding: var(--space-8) 0; /* Utilisation des variables de spacing de main.css */
}

/* --- Breadcrumbs --- */
.breadcrumb-section {
  background-color: var(--beige, #f8f4f0); /* Utiliser la couleur beige de main.css si définie */
  padding: var(--space-4) 0;
  font-size: var(--text-sm); /* Utilisation de la variable de taille de texte */
}

.breadcrumb-section ol {
  display: flex;
  align-items: center;
  list-style: none;
  padding: 0;
  margin: 0;
}

.breadcrumb-section a {
  color: var(--text-light, #6b7280);
  text-decoration: none;
  transition: color var(--transition-base);
}

.breadcrumb-section a:hover {
  color: var(--primary-orange, #e9741c); /* Utiliser la couleur primaire */
}

.breadcrumb-section .text-dark {
  color: var(--text-dark, #1f2937);
  font-weight: var(--font-medium);
}

/* --- Section Principale Détail Produit --- */
.product-detail-section {
  padding: var(--space-8) 0;
}

.product-detail-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-12);
}

@media (min-width: 768px) { /* md: */
  .product-detail-grid {
    grid-template-columns: 1fr 1fr; /* Deux colonnes sur écrans moyens et plus */
  }
}

/* --- Galerie d'Images --- */
.product-gallery {
  order: 1; /* Sur mobile, l'image vient avant les infos */
}

.main-image-container {
  background-color: var(--beige, #f8f4f0);
  border-radius: var(--radius-xl, 1rem); /* Bord arrondi */
  overflow: hidden;
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
  aspect-ratio: 1 / 1; /* Carré */
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-4);
}

.main-image-container img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain; /* Pour éviter la distorsion */
}

.thumbnail-gallery {
  display: flex;
  gap: var(--space-3);
  overflow-x: auto;
  padding-bottom: var(--space-2);
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.thumbnail-gallery::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera*/
}

.thumbnail-btn {
  border: 2px solid transparent; /* Bordure transparente par défaut */
  border-radius: var(--radius-lg, 0.5rem);
  overflow: hidden;
  flex-shrink: 0;
  cursor: pointer;
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  padding: 2px; /* Pour l'effet de bordure */
  background-color: var(--pure-white, #ffffff);
}

.thumbnail-btn img {
  width: 80px; /* Largeur fixe pour les vignettes */
  height: 80px; /* Hauteur fixe pour les vignettes */
  object-fit: cover; /* Couvrir le conteneur */
  display: block;
}

.thumbnail-btn.active,
.thumbnail-btn:hover {
  border-color: var(--primary-orange, #e9741c); /* Bordure orange quand active ou au survol */
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
}

.thumbnail-btn:focus {
  outline: 2px solid var(--primary-orange, #e9741c);
  outline-offset: 2px;
}

/* --- Informations du Produit --- */
.product-info {
  order: 2; /* Sur mobile, les infos viennent après l'image */
}

.info-header {
  margin-bottom: var(--space-6);
}

.product-title {
  font-family: var(--font-accent, sans-serif); /* Utiliser la police d'accent si définie */
  font-size: var(--text-3xl, 1.875rem); /* Taille de titre */
  font-weight: var(--font-bold, 700);
  color: var(--text-dark, #1f2937);
  margin-bottom: var(--space-3);
  line-height: 1.2;
}

.product-category {
  font-size: var(--text-sm, 0.875rem);
  color: var(--text-light, #6b7280);
  margin-bottom: var(--space-2);
}

.product-category i {
  margin-right: var(--space-1);
}

/* --- Notation (Étoiles) --- */
.product-rating {
  display: flex;
  align-items: center;
  margin-bottom: var(--space-4);
}

.stars {
  display: flex;
}

.stars i {
  color: var(--rating-star-empty, #d1d5db);
  margin-right: 2px; /* Espacement entre les étoiles */
}

.stars i.filled {
  color: var(--rating-star, #fbbf24);
}

.rating-text {
  font-size: var(--text-sm, 0.875rem);
  color: var(--text-light, #6b7280);
  margin-left: var(--space-2);
}

/* --- Prix --- */
.info-body {
  margin-bottom: var(--space-8);
}

.product-price {
  margin-bottom: var(--space-6);
}

.current-price {
  font-size: var(--text-3xl, 1.875rem);
  font-weight: var(--font-bold, 700);
  color: var(--primary-orange, #e9741c); /* Couleur du prix principal */
}

.original-price {
  font-size: var(--text-lg, 1.125rem);
  color: var(--text-light, #6b7280);
  text-decoration: line-through;
  margin-left: var(--space-3);
}

.discount-badge {
  background-color: var(--badge-discount-bg, #166534);
  color: var(--pure-white, #ffffff);
  font-size: var(--text-xs, 0.75rem);
  font-weight: var(--font-semibold, 600);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-full, 9999px);
  margin-left: var(--space-3);
  display: inline-flex; /* Pour aligner verticalement */
  align-items: center;
  justify-content: center;
}

/* --- Métadonnées (Stock, Vendeur) --- */
.product-meta {
  margin-bottom: var(--space-6);
}

.product-meta > div {
  display: flex;
  align-items: center;
  margin-bottom: var(--space-3);
}

.product-meta > div:last-child {
    margin-bottom: 0;
}

.product-meta .text-dark {
  font-weight: var(--font-medium, 500);
  margin-right: var(--space-3);
  min-width: 120px; /* Largeur minimale pour les labels */
}

.product-meta .text-forest {
  color: var(--badge-stock-bg, #16a34a);
  display: flex;
  align-items: center;
}

.product-meta .text-red-500 {
  color: var(--badge-outofstock-bg, #dc2626);
  display: flex;
  align-items: center;
}

.product-meta .text-light {
  color: var(--text-light, #6b7280);
}

.product-meta i {
  margin-right: var(--space-1);
}

/* --- Description --- */
.product-description {
  margin-bottom: var(--space-6);
}

.product-description h3 {
  font-size: var(--text-lg, 1.125rem);
  font-weight: var(--font-semibold, 600);
  color: var(--text-dark, #1f2937);
  margin-bottom: var(--space-3);
}

.product-description p {
  color: var(--text-light, #6b7280);
  line-height: 1.6;
}

/* --- Actions (Ajouter au panier, Acheter) --- */
.product-actions {
  border-top: 1px solid var(--product-detail-border, #e5e7eb);
  padding-top: var(--space-6);
}

/* --- Sélecteur de Quantité --- */
.quantity-selector {
  display: flex;
  align-items: center;
  margin-bottom: var(--space-4);
}

.quantity-selector label {
  font-weight: var(--font-medium, 500);
  color: var(--text-dark, #1f2937);
  margin-right: var(--space-3);
  min-width: 80px; /* Largeur fixe pour le label */
}

.quantity-controls {
  display: flex;
  align-items: center;
  border: 1px solid var(--border-light, #d1d5db);
  border-radius: var(--radius-full, 9999px);
  overflow: hidden;
  width: fit-content; /* S'adapte au contenu */
}

.quantity-btn {
  padding: var(--space-3) var(--space-4);
  background-color: var(--beige, #f8f4f0);
  border: none;
  cursor: pointer;
  font-size: var(--text-lg, 1.125rem);
  color: var(--text-dark, #1f2937);
  transition: background-color var(--transition-fast);
}

.quantity-btn:hover {
  background-color: var(--primary-orange, #e9741c);
  color: var(--pure-white, #ffffff);
}

.quantity-input {
  width: 60px;
  text-align: center;
  border: none;
  padding: var(--space-3) 0;
  font-weight: var(--font-medium, 500);
  color: var(--text-dark, #1f2937);
  -moz-appearance: textfield; /* Firefox */
}

.quantity-input::-webkit-outer-spin-button,
.quantity-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.quantity-info {
  font-size: var(--text-sm, 0.875rem);
  color: var(--text-light, #6b7280);
  margin-left: var(--space-3);
}

/* --- Boutons --- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-3) var(--space-6);
  border-radius: var(--radius-full, 9999px);
  font-weight: var(--font-medium, 500);
  font-size: var(--text-base, 1rem);
  cursor: pointer;
  transition: all var(--transition-base);
  text-decoration: none;
  border: none;
  gap: var(--space-2); /* Espacement entre l'icône et le texte */
}

.btn:focus {
  outline: 2px solid var(--primary-orange, #e9741c);
  outline-offset: 2px;
}

.btn-primary {
  background-color: var(--primary-orange, #e9741c);
  color: var(--pure-white, #ffffff);
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
}

.btn-primary:hover {
  background-color: #c25e16; /* Teinte plus foncée pour le survol */
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium, 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05));
}

.btn-primary:active {
  transform: translateY(0);
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
}

.btn-secondary {
  background-color: var(--forest-green, #228B22);
  color: var(--pure-white, #ffffff);
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
}

.btn-secondary:hover {
  background-color: #1a6b1a; /* Teinte plus foncée pour le survol */
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium, 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05));
}

.btn-secondary:active {
  transform: translateY(0);
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
}

#add-to-cart-btn {
  flex: 1; /* Prendre l'espace disponible */
}

#buy-now-btn {
  width: 100%;
  margin-top: var(--space-3);
}

/* --- Section Avis (Reviews) --- */
.reviews-section {
  margin-top: var(--space-16);
  padding-top: var(--space-12);
  border-top: 1px solid var(--product-detail-border, #e5e7eb);
}

.reviews-header {
  text-align: center;
  margin-bottom: var(--space-8);
}

.reviews-title {
  font-family: var(--font-accent, sans-serif);
  font-size: var(--text-2xl, 1.5rem);
  font-weight: var(--font-bold, 700);
  color: var(--text-dark, #1f2937);
  margin-bottom: var(--space-2);
}

.reviews-subtitle {
  font-size: var(--text-base, 1rem);
  color: var(--text-light, #6b7280);
}

/* Placeholder pour les avis - à styliser davantage selon vos besoins */
.review-placeholder {
  text-align: center;
  padding: var(--space-8);
  background-color: var(--beige, #f8f4f0);
  border-radius: var(--radius-xl, 1rem);
}

.review-placeholder p {
  color: var(--text-light, #6b7280);
  margin-bottom: var(--space-4);
}

/* --- Section Produits Similaires --- */
.related-products-section {
  margin-top: var(--space-16);
  padding-top: var(--space-12);
  border-top: 1px solid var(--product-detail-border, #e5e7eb);
  background-color: var(--gradient-soft, #f9fafb); /* Fond subtil si défini */
  padding: var(--space-12) 0;
}

.related-products-header {
  text-align: center;
  margin-bottom: var(--space-8);
}

.related-products-title {
  font-family: var(--font-accent, sans-serif);
  font-size: var(--text-2xl, 1.5rem);
  font-weight: var(--font-bold, 700);
  color: var(--text-dark, #1f2937);
  margin-bottom: var(--space-2);
}

.related-products-subtitle {
  font-size: var(--text-base, 1rem);
  color: var(--text-light, #6b7280);
}

.related-products-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 2 colonnes sur mobile */
  gap: var(--space-6);
}

@media (min-width: 768px) { /* md: */
  .related-products-grid {
    grid-template-columns: repeat(4, 1fr); /* 4 colonnes sur écrans moyens */
  }
}

/* Styles pour les cartes de produits similaires (réutiliser ceux de home.css si possible) */
.product-card {
  background: var(--pure-white, #ffffff);
  border-radius: var(--radius-2xl, 1.5rem);
  overflow: hidden;
  box-shadow: var(--shadow-soft, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06));
  transition: all var(--transition-growth, 0.3s ease-in-out);
  cursor: pointer;
  position: relative;
  display: flex;
  flex-direction: column;
  height: 100%; /* Pour aligner les hauteurs */
}

.product-card:hover {
  transform: translateY(-10px) translateX(2px);
  box-shadow: var(--shadow-strong, 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04));
}

.product-image {
  height: 180px; /* Hauteur fixe pour l'image */
  background: var(--beige, #f8f4f0);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  flex-shrink: 0; /* Empêche l'image de rétrécir */
}

.product-image img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
}

.product-info {
  padding: var(--space-4);
  flex-grow: 1; /* Pousse le contenu vers le bas */
  display: flex;
  flex-direction: column;
}

.product-title {
  font-family: var(--font-accent, sans-serif);
  font-size: var(--text-base, 1rem);
  font-weight: var(--font-semibold, 600);
  margin-bottom: var(--space-2);
  color: var(--text-dark, #1f2937);
  line-height: 1.4;
  flex-grow: 1; /* Permet au titre de prendre l'espace si la description est absente */
}

.product-price {
  font-weight: var(--font-bold, 700);
  color: var(--primary-orange, #e9741c);
  font-size: var(--text-lg, 1.125rem);
  margin-top: auto; /* Pousse le prix vers le bas */
}


/* --- Responsive --- */
@media (max-width: 768px) {
  .product-detail-container {
    padding: var(--space-4) 0;
  }

  .product-detail-section {
    padding: var(--space-6) 0;
  }

  .product-detail-grid {
    gap: var(--space-8);
  }

  .info-header {
    margin-bottom: var(--space-4);
  }

  .product-title {
    font-size: var(--text-2xl, 1.5rem);
  }

  .current-price {
    font-size: var(--text-2xl, 1.5rem);
  }

  .product-actions {
    padding-top: var(--space-4);
  }

  .quantity-selector {
    flex-direction: column;
    align-items: flex-start;
  }

  .quantity-selector label {
    margin-bottom: var(--space-2);
    margin-right: 0;
  }

  .quantity-info {
    margin-left: 0;
    margin-top: var(--space-1);
  }

  #buy-now-btn {
    margin-top: var(--space-2);
  }

  .reviews-section,
  .related-products-section {
    margin-top: var(--space-12);
    padding-top: var(--space-8);
  }

  .reviews-title,
  .related-products-title {
    font-size: var(--text-xl, 1.25rem);
  }
}

@media (max-width: 480px) {
  .thumbnail-btn img {
    width: 60px;
    height: 60px;
  }

  .product-image {
    height: 150px;
  }

  .related-products-grid {
    grid-template-columns: 1fr; /* 1 colonne sur très petit écran */
  }
}

/* --- Fin des styles spécifiques à la page produit --- */
</style>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Gestion de la Galerie d'Images ---
    const mainImage = document.getElementById('main-product-image');
    const thumbnailBtns = document.querySelectorAll('.thumbnail-btn');

    if (mainImage && thumbnailBtns.length > 0) {
        thumbnailBtns[0].classList.add('active'); // Activer la première vignette

        thumbnailBtns.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const fullImageUrl = this.getAttribute('data-full-image');
                
                // Mettre à jour l'image principale
                mainImage.src = fullImageUrl;
                mainImage.alt = "Image principale de " + document.querySelector('.product-title').textContent;

                // Mettre à jour l'état actif des vignettes
                thumbnailBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }

    // --- Gestion du Sélecteur de Quantité ---
    const qtyInput = document.getElementById('quantity');
    const decreaseBtn = document.getElementById('decrease-qty');
    const increaseBtn = document.getElementById('increase-qty');

    if (qtyInput && decreaseBtn && increaseBtn) {
        const maxQty = parseInt(qtyInput.max) || 999; // Limite de stock ou valeur par défaut
        const minQty = parseInt(qtyInput.min) || 1;

        function updateQty(newVal) {
            let val = parseInt(newVal);
            if (!isNaN(val)) {
                val = Math.max(minQty, Math.min(maxQty, val)); // S'assurer qu'on est dans les bornes
                qtyInput.value = val;
            }
        }

        decreaseBtn.addEventListener('click', () => updateQty(parseInt(qtyInput.value) - 1));
        increaseBtn.addEventListener('click', () => updateQty(parseInt(qtyInput.value) + 1));

        qtyInput.addEventListener('change', function() {
            updateQty(this.value);
        });
    }

    // --- Gestion de l'Ajout au Panier ---
    const addToCartForm = document.getElementById('add-to-cart-form');
    const addToCartBtn = document.getElementById('add-to-cart-btn');

    if (addToCartForm && addToCartBtn) {
        addToCartForm.addEventListener('submit', function(e) {
            e.preventDefault(); // Empêcher le rechargement de la page

            const productId = "{{ product.id }}"; // Récupéré depuis le contexte Django
            const quantity = parseInt(document.getElementById('quantity').value);

            if (isNaN(quantity) || quantity < 1) {
                alert("Veuillez sélectionner une quantité valide.");
                return;
            }

            // Animation ou feedback visuel
            const originalHtml = addToCartBtn.innerHTML;
            addToCartBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Ajout...';
            addToCartBtn.disabled = true;

            // Appel AJAX vers l'API Django (StoreView)
            fetch("{% url 'store:store_view' category.name|lower %}", { // URL du store de la catégorie
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: new URLSearchParams({
                    'action': 'add_to_cart',
                    'product_id': productId,
                    'quantity': quantity
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur réseau');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    console.error('Erreur serveur:', data.error);
                    alert('Erreur lors de l\'ajout au panier: ' + data.error);
                } else {
                    // Mise à jour du badge du panier dans le header
                    const cartBadge = document.getElementById('cart-badge');
                    if (cartBadge) {
                        cartBadge.textContent = data.cart.total_items;
                        cartBadge.classList.add('animate-pulse');
                        setTimeout(() => cartBadge.classList.remove('animate-pulse'), 1000);
                    }
                    // Feedback à l'utilisateur
                    alert(`"${data.added_item.product_name}" ajouté au panier!`);
                    // Rétablir le bouton
                     addToCartBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Ajouté!';
                    setTimeout(() => {
                         addToCartBtn.innerHTML = originalHtml;
                         addToCartBtn.disabled = false;
                    }, 1500);
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Une erreur est survenue. Veuillez réessayer.');
                // Rétablir le bouton
                addToCartBtn.innerHTML = originalHtml;
                addToCartBtn.disabled = false;
            });
        });
    }

    // --- Gestion du Bouton "Acheter Maintenant" (placeholder) ---
    const buyNowBtn = document.getElementById('buy-now-btn');
    if(buyNowBtn) {
        buyNowBtn.addEventListener('click', function() {
            alert("La fonctionnalité 'Acheter Maintenant' sera implémentée prochainement.");
            // Logique future: Rediriger vers le checkout avec ce produit
        });
    }
});
</script>
{% endblock %}